#!/bin/bash
# QUEUE=windows:lazarus

set -e -u -o pipefail

. $(dirname $0)/../.buildkite/env.sh

APP_VERSION=$(grep 'const AppVersion' studio/studio_tools.pas | cut -d "'" -f 2)

BITS="32 64"

echo "Building dd version $APP_VERSION for $BITS"

set_metadata version "$APP_VERSION"

echo '<img alt="Embedded Image" src="data:image/png;base64,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" />'

for BIT in $BITS ; do
	next_step build debug $BIT
done

